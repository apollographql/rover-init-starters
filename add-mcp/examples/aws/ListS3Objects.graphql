# ü™£ Let Claude browse your S3 bucket contents
#
# What Claude can do with this:
# - "Show me all files in the uploads folder"
# - "List recent documents in the reports bucket"
# - "Find all images with 'product' in the name"
# - "What files were modified this week?"
#
# Prerequisites:
# ‚úèÔ∏è Configure AWS S3 permissions for bucket access
# ‚úèÔ∏è Replace bucket names with your actual S3 buckets
# ‚úèÔ∏è Adjust prefix patterns to match your folder structure

query ListS3Objects($bucket: String!, $prefix: String, $maxKeys: Int = 100) {
  """
  Lists objects in an S3 bucket with optional prefix filtering.
  
  Claude will use this when you ask to browse files, search content,
  or explore your S3 storage structure.
  """
  listS3Objects(bucket: $bucket, prefix: $prefix, maxKeys: $maxKeys) @connect(
    source: "aws"
    http: {
      GET: "https://{$args.bucket}.s3.amazonaws.com/?list-type=2&prefix={$args.prefix}&max-keys={$args.maxKeys}"
    }
    selection: """
      objects {
        key
        size  
        lastModified
        storageClass
      }
      isTruncated
      nextToken
    """
  ) {
    objects {
      key            # Object key (file path) within the bucket
      size           # File size in bytes
      lastModified   # Timestamp of last modification
      storageClass   # Storage class (STANDARD, GLACIER, etc.)
    }
    isTruncated      # Whether more results exist beyond maxKeys
    nextToken        # Token for pagination to get more results
    # ‚úèÔ∏è Add more fields from S3 ListObjects response: owner, etag, etc.
    # ‚úèÔ∏è Update the selection mapping above to include additional object metadata
  }
}